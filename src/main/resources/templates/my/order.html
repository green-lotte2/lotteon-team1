<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/myLayout.html}">

<!--내용 시작-->
    <div id="my" layout:fragment="content">
        <script th:inline="javascript">

            /*
                #1. 회원이 구매한 모든 상품의 정보를 알고 있음
                #2. 우리는 10개씩 출력하고 싶음!
                #3. 우리는 총 구매한 상품의 갯수를 알고 있음
            */

            window.onload = function (){
                let MyOrderDTOList = [[${MyOrderDTOList.myOrderDTOList}]];
                console.log("MyOrderDTOList : " + MyOrderDTOList);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].prodName);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].prodCompany);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].thumb190);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].count);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].orderNo);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].detailPrice);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].detailStatus);
                console.log("MyOrderDTOList : " + MyOrderDTOList[1].orderDate);

                createOrdersList(0, 10);
            }

            function createOrdersList(firstNum, lastNum) {
                let MyOrderDTOList = [[${MyOrderDTOList.myOrderDTOList}]];

                // 화면이 로드될때 10개를 출력합니다.
                const ordersListTable = document.getElementById('ordersListTable'); // 테이블 할아버지
                const tableBody = document.getElementsByTagName('tbody')[0]; // 미국간 아빠

                // for(String aa : aaa)  / for(int i=0; i =< 10; i++)
                Array.from(MyOrderDTOList).forEach(function (MyOrderDTO, index) {
                    if (firstNum <= index && index < lastNum) {
                        console.log(index);
                        const eachOrderList = `<tr class="orderTemplate">
                                            <td class="date"></td>
                                            <td>
                                                <a href="#" class="thumb"><img src="/lotteon/uploads/${MyOrderDTO.thumb190}" alt="" style="width: 80px"></a>
                                                <ul>
                                                    <li class="company">${MyOrderDTO.prodCompany}</li>
                                                    <li class="prodName"><a href="#">${MyOrderDTO.prodName}</a></li>
                                                    <li>수량 : <span class="prodCount" >${MyOrderDTO.count}</span>개 / 주문번호 : <span class="ordNo" >${MyOrderDTO.orderNo}</span></li>
                                                    <li class="prodPrice">${MyOrderDTO.detailPrice}</li>
                                                </ul>
                                            </td>
                                            <td class="status">${MyOrderDTO.detailStatus}</td>
                                            <td class="confirm">
                                                <a href="#" class="receive">수취확인</a>
                                                <a href="#" class="review">상품평</a>
                                                <a href="#" class="refund">반품신청</a>
                                                <a href="#" class="exchange">교환신청</a>
                                            </td>
                                        </tr>`;

                        tableBody.insertAdjacentHTML('beforeend', eachOrderList);
                    }
                })
            }

            // 페이징 버튼 함수
            function pushPageButton() {
                const button = event.target; // 현재 함수를 실행시킨 태그
                const ordersListTable = document.getElementById('ordersListTable'); // 테이블 할아버지
                const tableBody = document.getElementsByTagName('tbody')[0]; // 미국간 아빠
                const orderTemplateAll = tableBody.querySelectorAll('.orderTemplate') // orderTemplate 클래스 네임들

                let num = button.innerText; // 1,2,3,4,5....

                Array.from(orderTemplateAll).forEach(function (orderTemplate){
                    orderTemplate.remove();
                })
                createOrdersList((num-1)*10, num*10);
            }

            // 10개 다음으로 버튼
            function pushNextButton() {
                const button = event.target; // 현재 함수를 실행시킨 태그
                const ordersListTable = document.getElementById('ordersListTable'); // 테이블 할아버지
                const tableBody = document.getElementsByTagName('tbody')[0]; // 미국간 아빠
                const orderTemplateAll = tableBody.querySelectorAll('.orderTemplate') // orderTemplate 클래스 네임들

                const lastNum = button.previousElementSibling.innerHTML;
                Array.from(orderTemplateAll).forEach(function (orderTemplate){
                    orderTemplate.remove();
                })
                createOrdersList(lastNum*10, (lastNum+1)*10);
            }

            // 10개 이전으로 버튼
            function pushNextButton() {
                const button = event.target; // 현재 함수를 실행시킨 태그
                const ordersListTable = document.getElementById('ordersListTable'); // 테이블 할아버지
                const tableBody = document.getElementsByTagName('tbody')[0]; // 미국간 아빠
                const orderTemplateAll = tableBody.querySelectorAll('.orderTemplate') // orderTemplate 클래스 네임들

                const firstNum = button.nextElementSibling.innerHTML;
                Array.from(orderTemplateAll).forEach(function (orderTemplate){
                    orderTemplate.remove();
                })
                createOrdersList((firstNum-1)*10, firstNum*10);
            }

        </script>
        <nav>
            <div>
                <a href="./home.html"><img th:src="@{/images/my/my_logo.jpg}" alt="나의쇼핑정보"></a>
                <ol>
                    <li><a href="#">주문·배송<span class="delivery">1</span></a></li>
                    <li><a href="#">할인쿠폰<span class="coupon">1</span></a></li>
                    <li><a href="#">포인트<span class="point">1,000</span></a></li>
                    <li><a href="#">문의내역<span class="qna">1</span></a></li>
                </ol>
            </div>
        </nav>

        <div class="ordered">
            <ul>
                <span class="menu_else"></span>
                <li><a th:href="@{/my/order}">전체주문내역</a></li>
                <!--<li><a href="./favorite.html">관심상품</a></li>-->
                <li><a th:href="@{/my/point}">포인트내역</a></li>
                <li><a th:href="@{/my/coupon}">쿠폰</a></li>
                <li><a th:href="@{/my/review}">나의리뷰</a></li>
                <li><a th:href="@{/my/qna}">문의하기</a></li>
                <li><a th:href="@{/my/info}">나의설정</a></li>
            </ul>

            <section>
                <a href="#"><img th:src="@{/images/my/my_banner1.jpg}" alt="패션, 타운 하나로 끝" class="banner"></a>
                <article>
                    <h3>전체주문내역</h3>

                    <div class="byDate">
                        <span class="tit">기간별조회</span>
                        <ul class="date_3ea">
                            <li><a href="#"><em>1</em>주일</a></li>
                            <li><a href="#"><em>15</em>일</a></li>
                            <li><a href="#" class="on"><em>1</em>개월</a></li>
                        </ul>
                        <ul class="date_5ea">
                            <li><a href="#"><em>11</em>월</a></li>
                            <li><a href="#"><em>10</em>월</a></li>
                            <li><a href="#"><em>9</em>월</a></li>
                            <li><a href="#"><em>8</em>월</a></li>
                            <li><a href="#"><em>7</em>월</a></li>
                        </ul>
                        <p>
                            <input type="date" name="begin"><span>~</span><input type="date" name="end">
                        </p>
                        <button class="btnConfirm">조회하기</button>
                    </div>

                    <table border="0" id="ordersListTable">
                        <tr>
                            <th>날짜</th>
                            <th>상품정보</th>
                            <th>상태</th>
                            <th>확인/신청</th>
                        </tr>
                    </table>

                    <p class="page">
                        <a href="#" class="prev">이전</a>

                        <a href="#" class="num" onclick="pushPageButton()" th:if="${MyOrderDTOList.end >= 10}" th:each="n : ${#numbers.sequence(1, 10)}" th:text="${n}"></a>
                        <a href="#" class="num" onclick="pushPageButton()" th:if="${MyOrderDTOList.end < 10}" th:each="n : ${#numbers.sequence(1, MyOrderDTOList.end)}" th:text="${n}"></a>

                        <a href="#" class="next" onclick="pushNextButton()">다음</a>
                    </p>

                </article>



            </section>

        </div>
    </div>
<!--내용 끝-->
</html>