<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/adminLayout.html}">

<!--내용 시작-->
    <section id="admin-cs-list" layout:fragment="content">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script type="text/javascript">
            $(function(){
                // 삭제 체크박스
                var chkObj = document.getElementsByName("RowCheck");
                // 체크된 글
                var rowCnt = chkObj.length;

                $("input[name='allCheck']").click(function(){
                    var chk_listArr = $("input[name='RowCheck']");
                    for(var i=0; i<chk_listArr.length; i++){
                        chk_listArr[i].checked = this.checked;
                    }
                });
                $("input[name='RowCheck']").click(function (){
                    if($("input[name='RowCheck']:checked").length == rowCnt){
                        $("input[name='allCheck']")[0].checked = true;
                    }else{
                        $("input[name='allCheck']")[0].checked = false;
                    }
                });
            });
            function deleteValue(){
                var url = "delete"; //controller를 보내고자하는 url
                var valueArr = new Array();
                var list = $("input[name='RowCheck']");
                for(var i=0; i<list.length; i++){
                    if(list[i].checked){ //선택되어 있으면 배열에 값을 저장함
                        valueArr.push(list[i].value);
                    }
                }
                if(valueArr.length == 0){
                    alert("선택된 글이 없습니다.");
                } else{
                    var chk = confirm("정말 삭제하시겠습니까?");
                    $.ajax({
                        url : url,              // 전송 URL
                        type : 'POST',          // POST방식
                        traditional : true,
                        data : {
                            valueArr : valueArr // 보내고자 하는 data 변수 설정
                        },
                        success: function (jdata){
                            if(jdata = 1){
                                alert("삭제 성공");
                                location.replace("/admin/cs/notice/list") // list로 페이지 새로고침
                            }else{
                                alert("삭제 실패");
                            }
                        }
                    });
                }
            }

        </script>
        <nav>
            <h3>공지사항 목록</h3>
            <p>
                HOME > 고객센터 > <strong>공지사항</strong>
            </p>
        </nav>
        <!-- 상품목록 컨텐츠 시작 -->
        <section>
            <div>
                <select name="search">
                    <option value="[유형선택]">유형선택</option>
                    <option value="[고객서비스]">고객서비스</option>
                    <option value="[이벤트당첨]">이벤트당첨</option>
                    <option value="[안전거래]">안전거래</option>
                    <option value="[위해상품]">위해상품</option>
                </select>
            </div>
            <table class="notice">
                <tr>
                    <th><input type="checkbox" name="allCheck"/></th>
                    <th>번호</th>
                    <th>유형</th>
                    <th>제목</th>
                    <th>조회</th>
                    <th>날짜</th>
                    <th>관리</th>
                </tr>

                <tr th:each="notice, index:${pageResponseDTO.dtoList}">
                    <td><input type="checkbox" name="RowCheck"/></td>
                    <td th:text="${pageResponseDTO.startNo - index.index}"></td>
                    <td th:text="${notice.noticeCate}" style="white-space: nowrap;"></td>
                    <td>
                        <span>
                            <a th:href="@{/admin/cs/notice/view(noticeNo=${notice.noticeNo})}">
                                <span th:text="${notice.noticeType + ' ' + notice.noticeTitle}"></span>
                            </a>
                        </span>
                    </td>
                    <td th:text="${notice.noticeHit}"></td>
                    <td th:if="${notice.noticeDate != null}" th:text="${#temporals.format(notice.noticeDate, 'yyyy-MM-dd')}" style="white-space: nowrap;" ></td>
                    <td>
                        <a th:href="@{/admin/cs/notice/delete(noticeNo=${notice.noticeNo})}">[삭제]</a><br>
                        <a th:href="@{/admin/cs/notice/modify(noticeNo=${notice.noticeNo})}">[수정]</a>
                    </td>
                </tr>
            </table>


            <input type="button" value="선택삭제" class="btn btn-outline-info" onclick="deleteValue();" style="background-color: #9e9e9e; color: white; border: none; padding: 10px 20px; cursor: pointer;"/>
            <a th:href="@{/admin/cs/notice/write}"><input type="button" value="작성하기" style=" float: right; background-color: #4291e9; color: white; border: none; padding: 10px 20px; cursor: pointer;" /></a>


            <div class="paging">
                <span class="prev">
                    <!-- 이전 버튼 -->
                    <a th:if="${pageResponseDTO.prev}" th:href="@{/admin/cs/notice/list(pg=${pageResponseDTO.start-1})}"><&nbsp;이전</a>
                </span>
                    <!-- 페이지 링크 -->
                <span class="num">
                    <th:block th:each="num:${#numbers.sequence(pageResponseDTO.start, pageResponseDTO.end)}">
                <a th:href="@{/admin/cs/notice/list(pg=${num})}" th:class="${pageResponseDTO.pg == num} ? 'current' : 'off'" th:text="${num}"></a>
                    </th:block>
                </span>
                    <!-- 다음 버튼 -->
                <span class="next">
                    <a th:if="${pageResponseDTO.next}" th:href="@{/admin/cs/notice/list(pg=${pageResponseDTO.end+1})}">다음</a>
                </span>
                </div>
        </section>
        <!-- 상품목록 컨텐츠 끝 -->
    </section>
<!--내용 끝-->
</html>