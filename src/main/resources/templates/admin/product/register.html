<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/adminLayout.html}">
<!--내용 시작-->
    <section id="admin-product-register" layout:fragment="content">
        <script>
            function onSelect(){
                var selectElement = document.getElementsByName('cate01No')[0];
                var selectedValue = selectElement.value;

                console.log(selectedValue);
                const jsonDate = {
                    cate01No : selectedValue
                };
                fetchPut(`/lotteon/admin/product/cate`, jsonDate)
                    .then(data => {
                        updateSecondDropdown(data);
                    })
                    .catch(error=>{
                        console.error(error);
                    });

                function updateSecondDropdown(cate02Data) {
                    var selectElement = document.getElementsByName('cate02No')[0];
                    selectElement.innerHTML = '<option value="">2차 분류 선택</option>';

                    // 받은 데이터로 옵션 추가
                    cate02Data.forEach(function(item) {
                        var optionElement = document.createElement('option');
                        optionElement.value = item.cate02No;
                        optionElement.textContent = item.cate02Name;
                        selectElement.appendChild(optionElement);
                    });

                    selectElement.onchange = function (){
                        var selectedCate01 = selectedValue;
                        var selectedCate02 = selectElement.value;
                        var cateCode = document.getElementsByName('cateCode')[0];
                        console.log(selectedCate01);
                        console.log(selectedCate02);

                        if (selectedCate01 && selectedCate02) {
                            cateCode.value = selectedCate01 + selectedCate02;
                        }else {
                            cateCode.value = '';
                        }
                    };
                }
            }

            function validateForm() {
                // 상품분류 섹션 필수 입력 필드 검사
                var cate01No = document.forms["prodRegisterForm"]["cate01No"].value;
                if (cate01No === "") {
                    alert("1차 분류를 선택해야 합니다.");
                    return false;
                }

                var cate02No = document.forms["prodRegisterForm"]["cate02No"].value;
                if (cate02No === "") {
                    alert("2차 분류를 선택해야 합니다.");
                    return false;
                }
                // 기본정보 섹션 필수 입력 필드 검사
                var prodName = document.forms["prodRegisterForm"]["prodName"].value;
                var prodPrice = document.forms["prodRegisterForm"]["prodPrice"].value;
                var prodStock = document.forms["prodRegisterForm"]["prodStock"].value;

                if (prodName === "") {
                    alert("상품명을 입력해야 합니다.");
                    return false;
                }
                if (prodPrice === "" || isNaN(prodPrice)) {
                    alert("유효한 판매가격을 입력해야 합니다.");
                    return false;
                }
                if (prodStock === "" || isNaN(prodStock)) {
                    alert("유효한 재고수량을 입력해야 합니다.");
                    return false;
                }

                // 상세 상품정보 섹션 필수 입력 필드 검사
                var multThumb940 = document.forms["prodRegisterForm"]["multThumb940"].value;
                if (multThumb940 === "") {
                    alert("상세 상품정보 이미지를 업로드해야 합니다.");
                    return false;
                }

                // 모든 필수 입력 필드가 비어있지 않다면 true 반환
                return true;
            }

            document.addEventListener('DOMContentLoaded', function (){
                const form = document.getElementById('prodRegisterForm');

                form.onsubmit = function (){
                    return validateForm();
                }
            })
        </script>
        <nav>
            <script th:src="@{/js/util.js}"></script>

            <h3>상품등록</h3>
            <p>
                HOME > 상품관리 > <strong>상품등록</strong>
            </p>
        </nav>
        <!-- 상품등록 컨텐츠 시작 -->
        <article>
            <form th:action="@{/admin/product/register}" method="post" id="prodRegisterForm" enctype="multipart/form-data">

                <!-- 상품분류 -->
                <section>
                    <h4>상품분류</h4>
                    <p>
                        기본분류는 반드시 선택하셔야 합니다. 하나의 상품에 1개의 분류를 지정 합니다.
                    </p>
                    <table>
                        <tr>
                            <td>1차 분류</td>
                            <td>
                                <select name="cate01No" onchange="onSelect()">
                                    <option value="">1차 분류 선택</option>
                                    <option value="AA">패션·의류·뷰티</option>
                                    <option value="BB">가전·디지털</option>
                                    <option value="CC">식품·생필품</option>
                                    <option value="DD">홈·문구·취미</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>2차 분류</td>
                            <td>
                                <select name="cate02No">
                                    <option value="">2차 분류 선택</option>
                                </select>
                            </td>
                        </tr>
                    </table>
                </section>
                <p><input type="hidden" name="cateCode"></p>
                <p><input type="hidden" name="prodSeller" value="aa11aa22"></p>

                <!-- 기본정보 -->
                <section>
                    <h4>기본정보</h4>
                    <p>
                        기본정보는 반드시 입력해야 합니다.
                    </p>
                    <table>
                        <tr>
                            <td>상품명</td>
                            <td><input type="text" name="prodName"/></td>
                        </tr>
                        <tr>
                            <td>기본설명</td>
                            <td>
                                <span>상품명 하단에 상품에 대한 추가적인 설명이 필요한 경우에 입력</span>
                                <input type="text" name="prodInfo"/>
                            </td>
                        </tr>
                        <tr>
                            <td>제조사</td>
                            <td><input type="text" name="prodCompany"/></td>
                        </tr>
                        <tr>
                            <td>판매가격</td>
                            <td><input type="text" name="prodPrice" oninput="validateNumber(this)"/>원</td>
                        </tr>
                        <tr>
                            <td>할인율</td>
                            <td>
                                <span>0을 입력하면 할인율 없음</span>
                                <input type="text" name="ProdDiscount" value="0" oninput="validateNumber(this)"/>원
                            </td>
                        </tr>
                        <tr>
                            <td>포인트</td>
                            <td>
                                <span>0을 입력하면 포인트 없음</span>
                                <input type="text" name="prodPoint" value="0" oninput="validateNumber(this)"/>점
                            </td>
                        </tr>
                        <tr>
                            <td>재고수량</td>
                            <td><input type="text" name="prodStock" oninput="validateNumber(this)"/>개</td>
                        </tr>
                        <tr>
                            <td>배송비</td>
                            <td>
                                <span>0을 입력하면 배송비 무료</span>
                                <input type="text" name="prodDeliveryFee" value="0" oninput="validateNumber(this)"/>원
                            </td>
                        </tr>
                        <tr>
                            <td>상품 썸네일</td>
                            <td>
                                <span>크기 190 x 190, 상품 목록에 출력될 이미지 입니다. </span>
                                <input type="file" name="multThumb190"/>

                                <span>크기 230 x 230, 상품 메인에 출력될 이미지 입니다. </span>
                                <input type="file" name="multThumb230"/>

                                <span>크기 456 x 456, 상품 상세에 출력될 이미지 입니다. </span>
                                <input type="file" name="multThumb456"/>
                            </td>
                        </tr>
                        <tr>
                            <td>상세 상품정보</td>
                            <td>
                                <span>크기 가로 940px 높이 제약없음, 크기 최대 1MB, 상세페이지 상품정보에 출력될 이미지 입니다.</span>
                                <input type="file" name="multThumb940"/>
                            </td>
                        </tr>
                    </table>
                </section>

                <!-- 상품정보 제공 고시 -->
                <section>
                    <h4>상품정보 제공고시</h4>
                    <p>
                        [전자상거래에 관한 상품정보 제공에 관한 고시] 항목에 의거 등록해야 되는 정보입니다.
                    </p>
                    <table>
                        <tr>
                            <td>상품상태</td>
                            <td><input type="text" name="prodStatus" value="새상품"/></td>
                        </tr>
                        <tr>
                            <td>부가세 면세여부</td>
                            <td><input type="text" name="prodTax" value="과세상품"/></td>
                        </tr>
                        <tr>
                            <td>영수증발행</td>
                            <td><input type="text" name="prodReceipt" value="발행가능 - 신용카드 전표, 온라인 현금영수증"/></td>
                        </tr>
                        <tr>
                            <td>사업자구분</td>
                            <td><input type="text" name="prodBusinessType" value="사업자 판매자"/></td>
                        </tr>
                        <tr>
                            <td>원산지</td>
                            <td><input type="text" name="prodOrg" value="국내산"/></td>
                        </tr>
                    </table>
                </section>

                <input type="submit" value="등록하기"/>
            </form>
        </article>

        <p class="ico alert">
            <strong>Warning!</strong>
            전자상거래 등에서의 상품 등의 정보제공에 관한 고시에 따라 총 35개 상품군에 대해 상품 특성 등을 양식에 따라 입력할 수 있습니다.
        </p>
        <!-- 상품등록 컨텐츠 끝 -->
    </section>
<!--내용 끝-->
</html>